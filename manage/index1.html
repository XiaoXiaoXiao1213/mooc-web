<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>文章编辑测试</title>
</head>

<body>
  <h2>文章标题</h2>
  <input type="text" class="title">
  <H2>文章封面</H2>
  <img width="200px" height="200px" class="cover">
  <h2>文章简介</h2>
  <input type="text" class="desc">
  <H2>文章内容</H2>
  <!-- <div id="editor">
    <p>欢迎使用 <b>wangEditor</b> 富文本编辑器</p>
  </div> -->
  <button class="submit">确定上传</button>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/swiper.min.js"></script>
<script src="js/common.js"></script>
<script src="js/axios.min.js"></script>
<script src="js/utils.js"></script>
<!-- <script src="//unpkg.com/wangeditor/release/wangEditor.min.js"></script> -->
<script type="text/javascript">
  $(function () {
    // var editor = new window.wangEditor('#editor')
    // editor.customConfig.menus = [
    //   'head',  // 标题
    //   'bold',  // 粗体
    //   'fontSize',  // 字号
    //   'fontName',  // 字体
    //   'italic',  // 斜体
    //   'underline',  // 下划线
    //   'strikeThrough',  // 删除线
    //   'foreColor',  // 文字颜色
    //   'backColor',  // 背景颜色
    //   'link',  // 插入链接
    //   'list',  // 列表
    //   'justify',  // 对齐方式
    //   'quote',  // 引用
    //   'emoticon',  // 表情
    //   'image',  // 插入图片
    //   'table',  // 表格
    //   'code',  // 插入代码
    //   'undo',  // 撤销
    //   'redo'  // 重复
    // ]
    // 关闭粘贴样式的过滤
    // editor.customConfig.pasteFilterStyle = false
    // 使用 base64 保存图片
    // editor.customConfig.uploadImgShowBase64 = true
    // 配置服务器端地址
    // editor.customConfig.uploadImgServer = '/bswapi/updateImages'
    // editor.customConfig.uploadFileName = 'files'
    // editor.customConfig.uploadImgHooks = {
    //   // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
    //   // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
    //   customInsert: function (insertImg, result, editor) {
    //     // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
    //     // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果

    //     // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
    //     console.log(result)
    //     var url = result.url
    //     insertImg(url)
    //     // result 必须是一个 JSON 格式字符串！！！否则报错
    //   }
    // }
    // editor.create()

    ///////////////////////
    let cover = null;
    $(".cover").click(function () {
      let input = document.createElement("input")
      input.type = "file"
      input.accept = ".jpeg,.jpg,.png"
      input.onchange = function ({ target }) {
        $(".cover").attr("src", URL.createObjectURL(cover = target.files[0]))
      }
      input.dispatchEvent(new MouseEvent("click"));
    })

    $(".submit").click(function () {
      (async function () {
        let type = 0;
        // let text = editor.txt.html();
        let title = $(".title").val();
        let desc = $(".desc").val();
        let author = "李二狗";
        try {
          let fromdata = new FormData();
          fromdata.append("type", type)
          fromdata.append("text", text)
          fromdata.append("title", title)
          fromdata.append("desc", desc)
          fromdata.append("author", author)
          fromdata.append("cover", cover)
          await Utils.POST("editArticle", fromdata)
          alert("添加成功")
        } catch (error) {

        }
      })()
    })

  })
</script>

</html>